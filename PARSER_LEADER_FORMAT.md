# Парсер переработан под формат отчёта ЛИДЕРА ✅

## Важно!

Парсер теперь работает с **отчётами лидеров**, а не со сводными отчётами ПГС!

## Формат отчёта лидера

Отчёт лидера имеет следующую структуру:

```
1) Заголовок отчёта
2) Количество и доказательства проведенных собеседований на сервере
3) Количество принятых, уволенных ПСЖ, уволенных с ОЧС сотрудников
4) Количество сотрудников во фракции (Первые ранги, Средний состав, Старший состав, Руководящий состав)
5) Количество проведенных обзвонов и принятых сотрудников в старший состав
6) Список кадровых перестановок в старшем составе
7) Список выданных выговоров
8) Фонд неустоек - список полученных и выплаченных
9) Список проведенных во фракции лекций, тренировок, RP мероприятий
   1. Лекции:
   2. Тренировки:
   3. Мероприятие:
10) Список мероприятий от всех филиалов организации
11) Проведение двух межфракционных мероприятий
12) Краткая оценка работы каждого сотрудника старшего состава
13) Генеральные построения
```

## Что изменилось в парсере

### Секция 2: Собеседования
- **Было:** Искал "2) Количество проведенных собеседований на сервере"
- **Стало:** Ищет "2) Количество и доказательства проведенных собеседований"
- Извлекает ВСЕ ссылки из секции
- Подсчитывает количество по нумерации (1., 2., 3.) или по количеству ссылок

### Секция 3: Изменения в составе
- Более гибкий парсинг с учётом пробелов в тексте
- Ищет каждое поле отдельно (не требует все поля сразу)

### Секция 4: Текущий состав
- **Было:** Искал пункт 5
- **Стало:** Ищет пункт 4
- Поддерживает "Первые ранги" вместо "Младший состав"
- Поддерживает "Руководящий состав"
- Учитывает пробелы в тексте ("Средний сос тав")

### Секция 5: Обзвоны
- **Было:** Искал пункт 6
- **Стало:** Ищет пункт 5
- Учитывает пробелы в словах

### Секция 6: Кадровые перестановки
- **Было:** Искал пункт 7
- **Стало:** Ищет пункт 6
- Поддерживает имена с пробелами ("Efes _ Capone")
- Автоматически убирает лишние пробелы из имён
- Ищет слово "переведён" (в дополнение к "назначен", "снят", "разжалован")

### Секция 7: Выговоры
- **Было:** Искал пункт 8
- **Стало:** Ищет пункт 7
- Поддерживает имена с пробелами
- Если в секции только "-", возвращает пустой список

### Секция 8: Фонд неустоек
- **Было:** Искал пункт 9
- **Стало:** Ищет пункт 8
- Ищет "Выплачено" вместо "Выплата премий"
- Более гибкий поиск каждого поля

### Секция 9: РП активности
- **Было:** Искал пункт 15
- **Стало:** Ищет пункт 9
- Ищет подсекции:
  - "1. Лекции:"
  - "2. Тренировки:"
  - "3. Мероприятие:"
- Мероприятия от всех филиалов ищет в пункте 10

## Особенности формата отчёта лидера

### Имена с пробелами
Отчёт лидера может содержать имена с пробелами:
```
Efes _ Capone
Denis _ Andreev
```
Парсер автоматически убирает лишние пробелы: `Efes_Capone`

### Пробелы в тексте
Текст может содержать случайные пробелы:
```
Средний сос тав
Ко личество обзвонов
```
Парсер учитывает это в регулярных выражениях

### Нумерация подпунктов
РП активности имеют нумерацию:
```
9) Список проведенных во фракции лекций, тренировок, RP мероприятий
  1. Лекции:
  2. Тренировки:
  3. Мероприятие:
```

## Как использовать

1. Получите отчёты от трёх лидеров (ГУВД-П, ГУВД-М, ГУВД-Н)
2. Загрузите их в систему
3. Нажмите "Сформировать отчёт"
4. Система автоматически извлечёт данные из каждого отчёта
5. Данные будут объединены в сводный отчёт ПГС

## Проверка

После генерации отчёта проверьте:
- ✅ Все собеседования извлечены (проверьте количество ссылок)
- ✅ Данные о составе корректны
- ✅ Кадровые перестановки отображаются
- ✅ Выговоры извлечены (если есть)
- ✅ РП активности разделены по категориям (лекции/тренировки/мероприятия)

## Если данные не парсятся

1. **Проверьте нумерацию** - секции должны быть пронумерованы 1), 2), 3) и т.д.
2. **Проверьте названия секций** - они должны соответствовать формату отчёта лидера
3. **Откройте консоль браузера** (F12) - там будут сообщения об ошибках
4. **Проверьте формат файла** - .txt или .docx (с установленным jszip)

## Технические детали

Все функции парсинга теперь:
- Ищут секции по номерам из отчёта лидера (2, 3, 4, 5, 6, 7, 8, 9, 10)
- Используют более гибкие регулярные выражения
- Учитывают пробелы в тексте и именах
- Ищут каждое поле отдельно (не требуют все поля сразу)

Это обеспечивает максимальную совместимость с реальными отчётами лидеров!
