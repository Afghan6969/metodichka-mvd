# Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ½Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°

## ğŸ“Š ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ—ĞĞŸĞ ĞĞ¡ĞĞ’                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ğ˜Ğ“Ğ ĞĞš      â”‚         â”‚   Ğ›Ğ˜Ğ”Ğ•Ğ  ĞŸĞ“Ğ¡  â”‚         â”‚   Ğ‘ĞĞ—Ğ       â”‚
â”‚              â”‚         â”‚   / Ğ“Ğ¡       â”‚         â”‚   Ğ”ĞĞĞĞ«Ğ¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚ 1. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ñƒ     â”‚                        â”‚
       â”‚ /account-request       â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â”‚ 2. Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ    â”‚                        â”‚
       â”‚    - ĞĞ¸Ğº               â”‚                        â”‚
       â”‚    - Ğ›Ğ¾Ğ³Ğ¸Ğ½             â”‚                        â”‚
       â”‚    - ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ            â”‚                        â”‚
       â”‚    - Ğ Ğ¾Ğ»ÑŒ              â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â”‚ 3. Ğ ĞµÑˆĞ°ĞµÑ‚ CAPTCHA      â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â”‚ 4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ   â”‚                        â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
       â”‚                        â”‚    5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:        â”‚
       â”‚                        â”‚       - Rate limit     â”‚
       â”‚                        â”‚       - Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ      â”‚
       â”‚                        â”‚       - Ğ”ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹      â”‚
       â”‚                        â”‚       - CAPTCHA        â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚    6. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ       â”‚
       â”‚                        â”‚       Ğ² Ğ‘Ğ”             â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ 7. Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ         â”‚                        â”‚
       â”‚    "Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½"  â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚ 8. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºÑƒ   â”‚
       â”‚                        â”‚    /admin/account-     â”‚
       â”‚                        â”‚    requests            â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚ 9. ĞŸÑ€Ğ¾ÑĞ¼Ğ°Ñ‚Ñ€Ğ¸Ğ²Ğ°ĞµÑ‚       â”‚
       â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                        â”‚    Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹             â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚ 10. ĞĞ´Ğ¾Ğ±Ñ€ÑĞµÑ‚/          â”‚
       â”‚                        â”‚     ĞÑ‚ĞºĞ»Ğ¾Ğ½ÑĞµÑ‚          â”‚
       â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
       â”‚                        â”‚    11. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ      â”‚
       â”‚                        â”‚        ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°         â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚    12. Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€:        â”‚
       â”‚                        â”‚        Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ        â”‚
       â”‚                        â”‚        Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ    â”‚
       â”‚                        â”‚        Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ users â”‚
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚    13. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ     â”‚
       â”‚                        â”‚        Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ        â”‚
       â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                        â”‚    14. ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ   â”‚
       â”‚                        â”‚                        â”‚
```

## ğŸ”„ Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ĞŸĞ ĞĞ¦Ğ•Ğ¡Ğ¡ ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ˜ Ğ—ĞĞŸĞ ĞĞ¡Ğ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START
  â”‚
  â”œâ”€> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ /account-request
  â”‚
  â”œâ”€> Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ CAPTCHA
  â”‚   â””â”€> GET /api/account-requests/generate-captcha
  â”‚       â””â”€> Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¼Ğ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ
  â”‚
  â”œâ”€> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ñƒ
  â”‚   â”œâ”€> ĞĞ¸Ğº (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)
  â”‚   â”œâ”€> Ğ›Ğ¾Ğ³Ğ¸Ğ½ (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)
  â”‚   â”œâ”€> ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ
  â”‚   â”œâ”€> ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
  â”‚   â”œâ”€> Ğ Ğ¾Ğ»ÑŒ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  â”‚   â””â”€> ĞÑ‚Ğ²ĞµÑ‚ Ğ½Ğ° CAPTCHA
  â”‚
  â”œâ”€> ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ"
  â”‚
  â”œâ”€> ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ĞµĞ¹
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° CAPTCHA
  â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ â†’ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸ STOP
  â”‚
  â”œâ”€> POST /api/account-requests/submit
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ IP Ğ°Ğ´Ñ€ĞµÑĞ°
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° CAPTCHA
  â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾ â†’ ĞÑˆĞ¸Ğ±ĞºĞ° 400
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ĞµĞ¹ (ÑĞµÑ€Ğ²ĞµÑ€)
  â”‚   â”‚   â”œâ”€> Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ½Ğ¸ĞºĞ° (3-50)
  â”‚   â”‚   â”œâ”€> Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ° (regex)
  â”‚   â”‚   â”œâ”€> Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ° (3-30)
  â”‚   â”‚   â”œâ”€> Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ° (regex)
  â”‚   â”‚   â”œâ”€> Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (6-100)
  â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ â†’ ĞÑˆĞ¸Ğ±ĞºĞ° 400
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Rate Limit
  â”‚   â”‚   â”œâ”€> Ğ’Ñ‹Ğ·Ğ¾Ğ² check_rate_limit(ip)
  â”‚   â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ·Ğ° 24Ñ‡
  â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½ â†’ ĞÑˆĞ¸Ğ±ĞºĞ° 429
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° pending Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
  â”‚   â”‚   â”œâ”€> ĞŸĞ¾Ğ¸ÑĞº pending Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ IP
  â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ ĞÑˆĞ¸Ğ±ĞºĞ° 409
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ°
  â”‚   â”‚   â”œâ”€> ĞŸĞ¾Ğ¸ÑĞº Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ users
  â”‚   â”‚   â”œâ”€> ĞŸĞ¾Ğ¸ÑĞº Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ account_requests
  â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ ĞÑˆĞ¸Ğ±ĞºĞ° 409
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ¥ÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
  â”‚   â”‚   â””â”€> bcrypt.hash(password, 10)
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
  â”‚   â”‚   â””â”€> INSERT INTO account_requests
  â”‚   â”‚       â”œâ”€> nickname
  â”‚   â”‚       â”œâ”€> login
  â”‚   â”‚       â”œâ”€> password_hash
  â”‚   â”‚       â”œâ”€> role
  â”‚   â”‚       â”œâ”€> ip_address
  â”‚   â”‚       â”œâ”€> user_agent
  â”‚   â”‚       â””â”€> status = 'pending'
  â”‚   â”‚
  â”‚   â””â”€> Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ÑƒÑĞ¿ĞµÑ…Ğ°
  â”‚       â””â”€> { success: true, requestId: ... }
  â”‚
  â”œâ”€> ĞŸĞ¾ĞºĞ°Ğ· ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± ÑƒÑĞ¿ĞµÑ…Ğµ
  â”‚
END
```

## âœ… Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ĞŸĞ ĞĞ¦Ğ•Ğ¡Ğ¡ ĞĞ”ĞĞ‘Ğ Ğ•ĞĞ˜Ğ¯ Ğ—ĞĞŸĞ ĞĞ¡Ğ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START
  â”‚
  â”œâ”€> Ğ›Ğ¸Ğ´ĞµÑ€ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ /admin/account-requests
  â”‚
  â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ°
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¾Ğ»Ğ¸ (Ğ›Ğ¸Ğ´ĞµÑ€ ĞŸĞ“Ğ¡ / Ğ“Ğ¡)
  â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° â†’ Redirect Ğ½Ğ° /
  â”‚
  â”œâ”€> GET /api/account-requests/list
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¾Ğ»Ğ¸
  â”‚   â”œâ”€> ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸Ğ· Ğ‘Ğ”
  â”‚   â”‚   â””â”€> SELECT * FROM account_requests
  â”‚   â”‚       WHERE status = ? (ĞµÑĞ»Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€)
  â”‚   â”‚       ORDER BY created_at DESC
  â”‚   â”‚       LIMIT ? OFFSET ?
  â”‚   â””â”€> Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ÑĞ¿Ğ¸ÑĞºĞ° Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸ĞµĞ¹
  â”‚
  â”œâ”€> ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
  â”‚   â”œâ”€> Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ° "ĞĞ¶Ğ¸Ğ´Ğ°ÑÑ‚" (pending)
  â”‚   â”œâ”€> Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ° "ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ½Ñ‹Ğµ" (approved)
  â”‚   â”œâ”€> Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ° "ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ½Ñ‹Ğµ" (rejected)
  â”‚   â””â”€> Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ° "Ğ’ÑĞµ" (all)
  â”‚
  â”œâ”€> Ğ›Ğ¸Ğ´ĞµÑ€ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "ĞĞ´Ğ¾Ğ±Ñ€Ğ¸Ñ‚ÑŒ" Ğ½Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ
  â”‚
  â”œâ”€> ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾
  â”‚   â”œâ”€> ĞŸĞ¾ĞºĞ°Ğ· Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
  â”‚   â””â”€> ĞŸĞ¾Ğ»Ğµ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ñ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  â”‚
  â”œâ”€> Ğ›Ğ¸Ğ´ĞµÑ€ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°ĞµÑ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ
  â”‚
  â”œâ”€> POST /api/account-requests/review
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
  â”‚   â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ°
  â”‚   â”‚   â””â”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¾Ğ»Ğ¸
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ¸Ğ· Ğ‘Ğ”
  â”‚   â”‚   â””â”€> SELECT * FROM account_requests
  â”‚   â”‚       WHERE id = requestId
  â”‚   â”‚
  â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
  â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ Ğ½Ğµ pending â†’ ĞÑˆĞ¸Ğ±ĞºĞ° 409
  â”‚   â”‚
  â”‚   â”œâ”€> ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
  â”‚   â”‚   â””â”€> UPDATE account_requests SET
  â”‚   â”‚       â”œâ”€> status = 'approved'
  â”‚   â”‚       â”œâ”€> comment = ?
  â”‚   â”‚       â”œâ”€> reviewed_by = userId
  â”‚   â”‚       â””â”€> reviewed_at = now()
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ¢Ğ Ğ˜Ğ“Ğ“Ğ•Ğ : auto_create_user_from_request
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: status = 'approved' AND OLD.status = 'pending'
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€> INSERT INTO users
  â”‚   â”‚       â”œâ”€> nickname = request.nickname
  â”‚   â”‚       â”œâ”€> login = request.login
  â”‚   â”‚       â”œâ”€> password_hash = request.password_hash
  â”‚   â”‚       â”œâ”€> role = request.role
  â”‚   â”‚       â””â”€> created_by = request.reviewed_by
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
  â”‚   â”‚   â””â”€> INSERT INTO user_logs
  â”‚   â”‚       â”œâ”€> action = 'account_request_approved'
  â”‚   â”‚       â”œâ”€> performed_by_id = userId
  â”‚   â”‚       â”œâ”€> target_user_nickname = request.nickname
  â”‚   â”‚       â””â”€> details = ...
  â”‚   â”‚
  â”‚   â””â”€> Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ÑƒÑĞ¿ĞµÑ…Ğ°
  â”‚
  â”œâ”€> ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
  â”‚
  â”œâ”€> ĞŸĞ¾ĞºĞ°Ğ· ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± ÑƒÑĞ¿ĞµÑ…Ğµ
  â”‚
END
```

## ğŸ›¡ï¸ ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ ÑĞ¿Ğ°Ğ¼Ğ° (Rate Limiting)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RATE LIMITING ĞŸĞ ĞĞ¦Ğ•Ğ¡Ğ¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ°ĞµÑ‚
  â”‚
  â”œâ”€> ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ IP Ğ°Ğ´Ñ€ĞµÑĞ°
  â”‚   â””â”€> x-forwarded-for Ğ¸Ğ»Ğ¸ x-real-ip
  â”‚
  â”œâ”€> Ğ’Ñ‹Ğ·Ğ¾Ğ² check_rate_limit(ip)
  â”‚   â”‚
  â”‚   â”œâ”€> SELECT * FROM request_rate_limits
  â”‚   â”‚   WHERE ip_address = ip
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ•ÑĞ»Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ½ĞµÑ‚:
  â”‚   â”‚   â””â”€> INSERT Ğ½Ğ¾Ğ²Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ
  â”‚   â”‚       â”œâ”€> request_count = 1
  â”‚   â”‚       â”œâ”€> last_request_at = now()
  â”‚   â”‚       â””â”€> RETURN true (Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾)
  â”‚   â”‚
  â”‚   â”œâ”€> Ğ•ÑĞ»Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ ĞµÑÑ‚ÑŒ:
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
  â”‚   â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ blocked_until > now()
  â”‚   â”‚   â”‚       â””â”€> RETURN false (Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½)
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºĞ½Ğ°
  â”‚   â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ last_request_at < (now() - 24h)
  â”‚   â”‚   â”‚       â””â”€> UPDATE: request_count = 1
  â”‚   â”‚   â”‚           â””â”€> RETURN true (ÑĞ±Ñ€Ğ¾Ñ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ°)
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€> ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°
  â”‚   â”‚   â”‚   â””â”€> Ğ•ÑĞ»Ğ¸ request_count >= 3
  â”‚   â”‚   â”‚       â””â”€> UPDATE: blocked_until = now() + 24h
  â”‚   â”‚   â”‚           â””â”€> RETURN false (Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚)
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€> Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ°
  â”‚   â”‚       â””â”€> UPDATE: request_count = request_count + 1
  â”‚   â”‚           â””â”€> RETURN true (Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾)
  â”‚   â”‚
  â”‚   â””â”€> Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
  â”‚
  â”œâ”€> Ğ•ÑĞ»Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾:
  â”‚   â””â”€> ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
  â”‚
  â””â”€> Ğ•ÑĞ»Ğ¸ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½:
      â””â”€> Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ 429
          â””â”€> "ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"
```

## ğŸ” ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ROW LEVEL SECURITY (RLS) ĞŸĞĞ›Ğ˜Ğ¢Ğ˜ĞšĞ˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: account_requests                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ INSERT (Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°):                                    â”‚
â”‚   â””â”€> ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: "Anyone can create account requests"         â”‚
â”‚       â””â”€> WITH CHECK (true)                                   â”‚
â”‚           â””â”€> âœ… Ğ›ÑĞ±Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹               â”‚
â”‚                                                               â”‚
â”‚ SELECT (ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²):                                   â”‚
â”‚   â””â”€> ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: "Leaders can view account requests"          â”‚
â”‚       â””â”€> USING (                                             â”‚
â”‚           EXISTS (                                            â”‚
â”‚             SELECT 1 FROM users                               â”‚
â”‚             WHERE users.id = auth.uid()                       â”‚
â”‚             AND users.role IN ('Ğ›Ğ¸Ğ´ĞµÑ€ ĞŸĞ“Ğ¡', 'Ğ“Ğ¡')            â”‚
â”‚             AND users.status = 'active'                       â”‚
â”‚           )                                                   â”‚
â”‚         )                                                     â”‚
â”‚         â””â”€> âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¸Ğ´ĞµÑ€Ñ‹ ĞŸĞ“Ğ¡ Ğ¸ Ğ“Ğ¡ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ°Ñ‚Ñ€Ğ¸Ğ²Ğ°Ñ‚ÑŒ    â”‚
â”‚                                                               â”‚
â”‚ UPDATE (ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²):                                 â”‚
â”‚   â””â”€> ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: "Leaders can update account requests"        â”‚
â”‚       â””â”€> USING Ğ¸ WITH CHECK (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ SELECT)             â”‚
â”‚           â””â”€> âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¸Ğ´ĞµÑ€Ñ‹ ĞŸĞ“Ğ¡ Ğ¸ Ğ“Ğ¡ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: request_rate_limits                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ ALL (Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸):                                           â”‚
â”‚   â””â”€> ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°: "Service role can manage rate limits"        â”‚
â”‚       â””â”€> TO service_role                                     â”‚
â”‚           â””â”€> âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ backend (service role) Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

account_requests
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ nickname (TEXT, NOT NULL)
â”œâ”€â”€ login (TEXT, NOT NULL, UNIQUE)
â”œâ”€â”€ password_hash (TEXT, NOT NULL)
â”œâ”€â”€ role (TEXT, nullable)
â”œâ”€â”€ status (TEXT, DEFAULT 'pending')
â”‚   â””â”€â”€ CHECK: 'pending' | 'approved' | 'rejected'
â”œâ”€â”€ comment (TEXT, nullable)
â”œâ”€â”€ created_at (TIMESTAMP, DEFAULT now())
â”œâ”€â”€ reviewed_by (UUID, FK â†’ users.id)
â”œâ”€â”€ reviewed_at (TIMESTAMP, nullable)
â”œâ”€â”€ ip_address (TEXT)
â””â”€â”€ user_agent (TEXT)

request_rate_limits
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ ip_address (TEXT, NOT NULL)
â”œâ”€â”€ request_count (INTEGER, DEFAULT 1)
â”œâ”€â”€ last_request_at (TIMESTAMP, DEFAULT now())
â””â”€â”€ blocked_until (TIMESTAMP, nullable)

Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹:
â”œâ”€â”€ idx_account_requests_status
â”œâ”€â”€ idx_account_requests_created_at
â”œâ”€â”€ idx_account_requests_ip_address
â”œâ”€â”€ idx_account_requests_login
â”œâ”€â”€ idx_rate_limits_ip
â””â”€â”€ idx_rate_limits_blocked_until
```

## ğŸ¯ Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜ĞĞĞĞ«Ğ• Ğ¢ĞĞ§ĞšĞ˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend Components:
â”œâ”€â”€ AccountRequestForm (/account-request)
â”‚   â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚: submit API, generate-captcha API
â”‚
â””â”€â”€ AccountRequestsAdmin (/admin/account-requests)
    â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚: list API, review API

API Routes:
â”œâ”€â”€ /api/account-requests/submit
â”‚   â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚: spam-protection utils, Supabase
â”‚
â”œâ”€â”€ /api/account-requests/list
â”‚   â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚: auth verification, Supabase
â”‚
â”œâ”€â”€ /api/account-requests/review
â”‚   â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚: auth verification, Supabase, triggers
â”‚
â””â”€â”€ /api/account-requests/generate-captcha
    â””â”€â”€ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼Ğ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ CAPTCHA

Database Functions:
â”œâ”€â”€ check_rate_limit(ip_address)
â”‚   â””â”€â”€ Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ·: submit API
â”‚
â””â”€â”€ auto_create_user_from_request()
    â””â”€â”€ Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ: Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¾Ğ¼ Ğ¿Ñ€Ğ¸ UPDATE

Triggers:
â””â”€â”€ trigger_auto_create_user_from_request
    â””â”€â”€ Ğ¡Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚: AFTER UPDATE Ğ½Ğ° account_requests
        â””â”€â”€ Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ: status Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ½Ğ° 'approved'
```

---

**Ğ­Ñ‚Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ½Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°.**
