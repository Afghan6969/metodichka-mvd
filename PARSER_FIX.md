# Исправление парсера отчётов ПГС ✅

## Проблема

Парсер извлекал только ЧАСТЬ информации из отчётов, потому что:
- Искал данные по всему тексту, а не в конкретных секциях
- Мог находить неправильные совпадения из других частей отчёта
- Не учитывал структуру отчёта с нумерованными разделами

## Решение

Полностью переработан алгоритм парсинга:

### До исправления:
```typescript
// Искал по всему тексту
const pattern = new RegExp(`${fraction}[\\s\\S]*?Всего:\\s*(\\d+)`, 'i');
const match = text.match(pattern);
```

### После исправления:
```typescript
// Сначала находим нужную секцию отчёта
const interviewSectionMatch = text.match(/2\)\s*Количество проведенных собеседований[\s\S]*?(?=3\)|$)/i);

// Потом ищем данные только в этой секции
if (interviewSectionMatch) {
  const interviewSection = interviewSectionMatch[0];
  const fractionPattern = new RegExp(`${fraction}[\\s\\S]*?Всего:\\s*(\\d+)`, 'i');
  const match = interviewSection.match(fractionPattern);
}
```

## Что исправлено

### ✅ Секция 2: Собеседования
- Теперь ищет только в разделе "2) Количество проведенных собеседований"
- Правильно извлекает все ссылки для каждого ГУВД

### ✅ Секция 3: Изменения в составе
- Ищет только в разделе "3) Количество принятых и уволенных"
- Точно находит данные для каждой фракции

### ✅ Секция 5: Текущий состав
- Ищет только в разделе "5) Количество сотрудников во фракции"
- Правильно парсит младший/средний/старший состав

### ✅ Секция 6: Обзвоны
- Ищет только в разделе "6) Количество проведенных обзвонов"
- Точно извлекает количество обзвонов и принятых

### ✅ Секция 7: Кадровые перестановки
- Ищет только в разделе "7) Список кадровых перестановок"
- Находит все назначения и снятия

### ✅ Секция 8: Выговоры
- Ищет только в разделе "8) Список выданных выговоров"
- Извлекает все выговоры с причинами

### ✅ Секция 9: Фонд неустоек
- Ищет только в разделе "9) Фонд неустоек"
- Правильно парсит получено/выплачено/остаток

### ✅ Секция 10: Назначения лидеров
- Ищет только в разделе "10) Кадровые назначения на пост лидера"
- Точно извлекает имя и дату назначения

### ✅ Секция 15: РП активности
- Ищет только в разделе "15) Список проведенных во фракции RP ситуаций"
- Правильно разделяет лекции/тренировки/мероприятия

## Преимущества нового подхода

1. **Точность** - парсер ищет данные только в нужных секциях
2. **Надёжность** - не путает данные из разных разделов отчёта
3. **Полнота** - извлекает ВСЮ информацию из каждой секции
4. **Гибкость** - работает даже если секции идут не по порядку

## Как проверить

1. Загрузите полные отчёты от трёх лидеров
2. Нажмите "Сформировать отчёт"
3. Проверьте вкладку "Отчёт" - теперь должны отображаться ВСЕ данные:
   - Все собеседования
   - Все изменения в составе
   - Все кадровые перестановки
   - Все выговоры
   - Все РП активности

## Что делать, если данные всё равно не парсятся

1. **Проверьте формат отчёта** - секции должны быть пронумерованы (1), 2), 3) и т.д.)
2. **Проверьте названия фракций** - должны быть точно ГУВД-П, ГУВД-М, ГУВД-Н
3. **Проверьте структуру** - каждая секция должна содержать данные для всех трёх ГУВД
4. **Откройте консоль браузера** (F12) - там будут сообщения об ошибках парсинга

## Технические детали

Изменённый файл: `lib/pgs-report-parser.ts`

Все функции парсинга теперь:
1. Находят нужную секцию по номеру (например, "2)")
2. Извлекают текст только этой секции
3. Ищут данные конкретной фракции внутри секции
4. Возвращают структурированные данные

Это гарантирует, что данные извлекаются из правильного места в отчёте!
